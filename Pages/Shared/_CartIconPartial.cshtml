@* Pages/Shared/_CartIconPartial.cshtml *@
@inject E_commerce.Services.Interfaces.ICartService CartService

@{
    try
    {
        var userId = User.Identity?.IsAuthenticated == true
            ? User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value
            : null;

        // Le service gère automatiquement :
        // - cookie si userId == null
        // - DB si user connecté
        var itemCount = await CartService.GetCartItemCountAsync(userId);

        <a asp-page="/Cart/Index" class="nav-link position-relative">
            <i class="fas fa-shopping-cart fa-lg"></i>

            @if (itemCount > 0)
            {
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                    @itemCount
                    <span class="visually-hidden">articles dans le panier</span>
                </span>
            }
        </a>
    }
    catch
    {
        // Sécurité : afficher seulement l'icône si erreur
        <a asp-page="/Cart/Index" class="nav-link position-relative">
            <i class="fas fa-shopping-cart fa-lg"></i>
        </a>
    }
}
